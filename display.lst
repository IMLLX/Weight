C51 COMPILER V9.01   DISPLAY                                                               11/16/2020 22:49:56 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE DISPLAY
OBJECT MODULE PLACED IN display.obj
COMPILER INVOKED BY: D:\Program Files\keil\C51\BIN\C51.EXE src\display.c BROWSE DEBUG OBJECTEXTEND PRINT(.\display.lst) 
                    -OBJECT(display.obj)

line level    source

   1          #include "weigh.h"
   2          #define LCD_BUS P0 // 12864液晶接口总线
   3          
   4          sbit LCD_RS = P3 ^ 5;  // 低电平为写指令，高电平为写数据端
   5          sbit LCD_RW = P3 ^ 6;  // 低电平为写，高电平为读
   6          sbit LCD_EN = P3 ^ 4;  // 使能端
   7          sbit LCD_PSB = P3 ^ 7; // 并行输入
   8          sbit busy = P0 ^ 7;    // 忙端口
   9          
  10          
  11          
  12          /********************************************************************
  13          函数名称: void Check_Busy()             
  14          功能简介: 读检测12864液晶内部工作状态
  15          入口参数: 无
  16          返回值  ：无
  17          *********************************************************************/
  18          void await_lcd()
  19          {
  20   1          LCD_BUS = 0xff; // 把LCD_BUS拉高为输入端
  21   1          LCD_RS = 0;
  22   1          LCD_RW = 1; // 读
  23   1          LCD_EN = 1;
  24   1          delay(5);
  25   1          while ((LCD_BUS & 0x80) == 0x80)
  26   1              ; // LCD_BUS最高位为STA7返回值，0允许操作，1禁止
  27   1          // while (!LCD_BUS);
  28   1          // while (busy);
  29   1          LCD_EN = 0;
  30   1      }
  31          
  32          /********************************************************************
  33          函数名称: void write_cmd(unsigned char cmd)     
  34          功能简介: 12864液晶写指令
  35          入口参数: UINT_8 cmd
  36          返回值  ：无
  37          *********************************************************************/
  38          void write_cmd(unsigned char cmd)
  39          {
  40   1          // await_lcd();
  41   1          LCD_RS = 0;
  42   1          LCD_RW = 0;
  43   1          LCD_EN = 0;
  44   1          LCD_BUS = cmd;
  45   1          delay(5);
  46   1          LCD_EN = 1; //在使能端LCD_EN上升沿时把指令cmd写入
  47   1          delay(5);
  48   1          LCD_EN = 0;
  49   1      }
  50          
  51          /********************************************************************
  52          函数名称: void write_data(unsigned char dat)
  53          功能简介: 12864液晶写数据
  54          入口参数: UINT_8 data
C51 COMPILER V9.01   DISPLAY                                                               11/16/2020 22:49:56 PAGE 2   

  55          返回值  ：无
  56          *********************************************************************/
  57          void write_data(unsigned char dat)
  58          {
  59   1          // await_lcd();
  60   1          LCD_RS = 1;
  61   1          LCD_RW = 0;
  62   1          LCD_EN = 0;
  63   1          LCD_BUS = dat;
  64   1          Nop(3);
  65   1          LCD_EN = 1;
  66   1          Nop(3);
  67   1          LCD_EN = 0;
  68   1      }
  69          
  70          /********************************************************************
  71          函数名称: dis_init()
  72          功能简介: 12864液晶初始化
  73          入口参数: 无
  74          返回值  ：无
  75          *********************************************************************/
  76          void dis_init()
  77          {
  78   1          Nop(3);
  79   1          LCD_PSB = 1;        // 串行
  80   1          write_cmd(0x30);    // 8为并行，指令为基本指令
  81   1          delay(5);
  82   1          write_cmd(0x0c); // 显示开
  83   1          delay(5);
  84   1          write_cmd(0x01); // 清屏
  85   1          delay(5);
  86   1          write_cmd(0x06);
  87   1          delay(5);
  88   1      }
  89          
  90          /********************************************************************
  91          函数名称: void display(unsigned char x, unsigned char y, unsigned char *string) 
  92          功能简介: 液晶DDRAM地址选择显示,x选择行，y选择列，string指针传递字符串
  93          入口参数: UINT_8 x, UINT_8 y, UINT_8 *string
  94          返回值  ：无
  95          *********************************************************************/
  96          void display(unsigned char x, unsigned char y, unsigned char *string)
  97          {
  98   1          switch (x)
  99   1          {
 100   2          case 0:
 101   2              write_cmd(0x80 + y);
 102   2              break;
 103   2          case 1:
 104   2              write_cmd(0x90 + y);
 105   2              break;
 106   2          case 2:
 107   2              write_cmd(0x88 + y);
 108   2              break;
 109   2          case 3:
 110   2              write_cmd(0x98 + y);
 111   2              break;
 112   2          default:
 113   2              break;
 114   2          }
 115   1          while (*string != '\0')
 116   1          {
C51 COMPILER V9.01   DISPLAY                                                               11/16/2020 22:49:56 PAGE 3   

 117   2              write_data(*string);
 118   2              string++;
 119   2          }
 120   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    206    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
