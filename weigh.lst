C51 COMPILER V9.01   WEIGH                                                                 11/20/2020 00:31:49 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE WEIGH
OBJECT MODULE PLACED IN weigh.obj
COMPILER INVOKED BY: D:\Program Files\keil\C51\BIN\C51.EXE src\weigh.c BROWSE DEBUG OBJECTEXTEND PRINT(.\weigh.lst) OBJE
                    -CT(weigh.obj)

line level    source

   1          #include "weigh.h"
   2          const unsigned char code Welcome[] = {"Welcome To Use!"};
   3          const unsigned char title[] = {"By XZL & LLX"};
   4          const unsigned char code PreWeight[] = {"Value:"};
   5          const unsigned char digits[] = "0123456789";
   6          const unsigned char code overWeight[] = {"超出量程"};
   7          unsigned char WeightTab[9];                      // 存质量字符串
   8          unsigned char code clearTable[] = {"         "}; // 清空
   9          
  10          unsigned long var;
  11          const unsigned long varPian = 400;
  12          const float OneYuan = 2900.0;
  13          
  14          unsigned char WeightString[8];
  15          unsigned long temp; // 缓存质量
  16          unsigned char k = 0;
  17          unsigned long t; // 硬币个数
  18          
  19          void init(void);
  20          int loop(void);
  21          char *int2str(unsigned long);
  22          void calYingbi(unsigned long);
  23          unsigned long abs(long);
  24          void getOffset();
  25          
  26          void main()
  27          {
  28   1          init();
  29   1          while (1)
  30   1          {
  31   2              loop();
  32   2          }
  33   1      }
  34          
  35          int loop(void)
  36          {
  37   1          temp = Hx711();
  38   1          display(2, 0, clearTable);
  39   1          calYingbi(temp);
  40   1          display(2, 0, int2str(t));
  41   1      
  42   1          return 0;
  43   1      }
  44          
  45          void init(void)
  46          {
  47   1          delay(10);
  48   1          dis_init();
  49   1          display(0, 0, Welcome);
  50   1          display(1, 0, PreWeight);
  51   1          display(3, 0, title);
  52   1          getOffset();
  53   1      }
  54          
C51 COMPILER V9.01   WEIGH                                                                 11/20/2020 00:31:49 PAGE 2   

  55          /** 调用 times 次 nop 函数*/
  56          void Nop(unsigned char times)
  57          {
  58   1          int i = 0;
  59   1          for (i = 0; i < times; i++)
  60   1          {
  61   2              _nop_();
  62   2          }
  63   1          return;
  64   1      }
  65          
  66          /********************************************************************
  67          函数名称: void delay(unsigned int x)    
  68          功能简介: 晶振为11.0592MHZ时定时xms
  69          入口参数: unsigned int x
  70          返回值  ：无
  71          *********************************************************************/
  72          void delay(unsigned int x)
  73          {
  74   1          unsigned int i, j = 110;
  75   1          for (i = 0; i < x; i++)
  76   1          {
  77   2              for (j = 0; j < 100; j++)
  78   2                  ;
  79   2          }
  80   1      }
  81          
  82          char *int2str(unsigned long values)
  83          {
  84   1          char *crtn = WeightString;
  85   1          crtn += 7;
  86   1          *crtn = '\0';
  87   1          do
  88   1          {
  89   2              *--crtn = digits[values % 10];
  90   2          } while (values /= 10);
  91   1          return crtn;
  92   1      }
  93          
  94          void calYingbi(unsigned long temp)
  95          {
  96   1          if (abs(temp - var) < varPian)
  97   1          {
  98   2              t = 0;
  99   2              return;
 100   2          }
 101   1          else
 102   1          {
 103   2              t = abs(temp - var) / OneYuan + 0.5;
 104   2              return;
 105   2          }
 106   1      }
 107          
 108          unsigned long abs(long i)
 109          {
 110   1          if (i <= 0)
 111   1              return -i;
 112   1          return i;
 113   1      }
 114          
 115          void getOffset()
 116          {
C51 COMPILER V9.01   WEIGH                                                                 11/20/2020 00:31:49 PAGE 3   

 117   1          unsigned char i = 0;
 118   1          unsigned long OffsetSum = 0;
 119   1          for (i = 0; i < 5; i++)
 120   1          {
 121   2              OffsetSum += Hx711();
 122   2          }
 123   1          var = OffsetSum / 5;
 124   1          return;
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    510    ----
   CONSTANT SIZE    =     42    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     62      20
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
