C51 COMPILER V9.01   WEIGH                                                                 11/16/2020 22:49:56 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE WEIGH
OBJECT MODULE PLACED IN weigh.obj
COMPILER INVOKED BY: D:\Program Files\keil\C51\BIN\C51.EXE src\weigh.c BROWSE DEBUG OBJECTEXTEND PRINT(.\weigh.lst) OBJE
                    -CT(weigh.obj)

line level    source

   1          #include "weigh.h"
   2          
   3          const unsigned char code title[] = {"硬币称重"};
   4          const unsigned char code overWeight[] = {"超出量程"};
   5          unsigned char WeightTab[6]; // 存质量字符串
   6          unsigned char code clearTable[] = {"          "};                        // 清空
   7          
   8          unsigned char WeightString[8];
   9          float perWeight;    // 单个硬币质量
  10          float totalWeight;  // 总质量
  11          unsigned long temp; // 缓存质量
  12          unsigned char k = 0;
  13          unsigned char t;
  14          
  15          
  16          sbit wela = P2 ^ 6;
  17          sbit dula = P2 ^ 7;
  18          
  19          void init(void);
  20          int loop(void);
  21          void mitoa(int, char str[]);
  22          
  23          void mitoa(int num, char str[])
  24          {
  25   1          int sign;
  26   1          unsigned char i = 0, j = 0;
  27   1          unsigned char temp[10];
  28   1          sign = num;
  29   1          do
  30   1          {
  31   2              temp[i] = sign % 10 + '0';
  32   2              sign /= 10;
  33   2              i++;
  34   2          } while (sign > 0);
  35   1          while (i > 0)
  36   1          {
  37   2              str[j] = temp[i - 1];
  38   2              j++;
  39   2              i--;
  40   2          }
  41   1          str[j] = '\0';
  42   1      }
  43          
  44          void main()
  45          {
  46   1          init();
  47   1          getOffset(10); // 初始化质量
  48   1          while (!loop())
  49   1              ;
  50   1      }
  51          
  52          int loop(void)
  53          {
  54   1          temp = 0;
C51 COMPILER V9.01   WEIGH                                                                 11/16/2020 22:49:56 PAGE 2   

  55   1          temp = getWeight();
  56   1          // if (temp >= 1000)
  57   1          // {
  58   1          //     display(0, 0, overWeight);
  59   1          // }
  60   1          if (temp == 0)
  61   1          {
  62   2              WeightTab[0] = '0';
  63   2              k = 1;
  64   2          }
  65   1          else
  66   1          {
  67   2              init_WeiTag(WeightTab,clearTable);
  68   2              k = 0;
  69   2              while (temp != 0)
  70   2              {
  71   3                  WeightTab[k++] = 0x30 + temp % 10; //提取十进制最后一位转换为字符
  72   3                  temp /= 10;
  73   3              }
  74   2          }
  75   1          write_cmd(0x93);
  76   1          while (k > 0)
  77   1          {
  78   2              write_data(WeightTab[k--]);
  79   2          }
  80   1          return 0;
  81   1      }
  82          
  83          void init(void)
  84          {
  85   1          dula = 1;
  86   1          P0 = 0xff;
  87   1          dula = 0;
  88   1          wela = 1;
  89   1          P0 = 0x00;
  90   1          wela = 0;
  91   1          delay(10);
  92   1          // time_init();
  93   1          dis_init();
  94   1          display(0, 0, "Hello World");
  95   1          display(2,0,title);
  96   1      }
  97          
  98          /** 调用 times 次 nop 函数*/
  99          void Nop(unsigned char times)
 100          {
 101   1          int i = 0;
 102   1          for (i = 0; i < times; i++)
 103   1          {
 104   2              _nop_();
 105   2          }
 106   1          return;
 107   1      }
 108          
 109          /********************************************************************
 110          函数名称: void delay(unsigned int x)    
 111          功能简介: 晶振为11.0592MHZ时定时xms
 112          入口参数: unsigned int x
 113          返回值  ：无
 114          *********************************************************************/
 115          void delay(unsigned int x)
 116          {
C51 COMPILER V9.01   WEIGH                                                                 11/16/2020 22:49:56 PAGE 3   

 117   1          unsigned int i, j = 110;
 118   1          for (i = 0; i < x; i++)
 119   1          {
 120   2              for (j = 0; j < 100; j++)
 121   2                  ;
 122   2          }
 123   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    414    ----
   CONSTANT SIZE    =     41    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     28      15
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
